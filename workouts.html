<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Tracker - Gainly</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h2>Gainly</h2>
            </div>
            <div class="nav-links">
                <a href="dashboard.html" class="nav-link">Dashboard</a>
                <a href="calories.html" class="nav-link">Calories</a>
                <a href="workouts.html" class="nav-link active">Workouts</a>
                <a href="recipes.html" class="nav-link">
                    Recipes
                </a>
                <a href="progress.html" class="nav-link">
                    Progress
                </a>
                <a href="profile.html" class="nav-link">Profile</a>
            </div>
            <button onclick="logout()" class="btn btn-small">Logout</button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div class="page-container">
            <!-- Page Header -->
            <div class="page-header">
                <div>
                    <h1>Workout Tracker</h1>
                    <p class="page-subtitle">Log your exercises and track your progress</p>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="date" id="selectedDate" onchange="loadWorkoutsForDate()" />
                    <button onclick="openAddWorkoutModal()" class="btn">+ Log Workout</button>
                </div>
            </div>

            <!-- Workout Summary Card -->
            <div class="workout-summary">
                <div class="workout-stat-card">
                    <span class="workout-icon">üí™</span>
                    <div>
                        <div class="workout-stat-value" id="totalWorkouts">0</div>
                        <div class="workout-stat-label">Workouts Today</div>
                    </div>
                </div>
                <div class="workout-stat-card">
                    <span class="workout-icon">üî•</span>
                    <div>
                        <div class="workout-stat-value" id="totalExercises">0</div>
                        <div class="workout-stat-label">Exercises</div>
                    </div>
                </div>
                <div class="workout-stat-card">
                    <span class="workout-icon">‚è±Ô∏è</span>
                    <div>
                        <div class="workout-stat-value" id="totalDuration">0</div>
                        <div class="workout-stat-label">Minutes</div>
                    </div>
                </div>
                <div class="workout-stat-card">
                    <span class="workout-icon">üèãÔ∏è</span>
                    <div>
                        <div class="workout-stat-value" id="totalVolume">0</div>
                        <div class="workout-stat-label">lbs Lifted</div>
                    </div>
                </div>
            </div>

            <!-- Workouts List -->
            <div class="workouts-section">
                <h2 id="workoutsHeader">Today's Workouts</h2>
                <div id="workoutsList" class="workouts-list">
                    <div class="empty-state">
                        <p>No workouts logged yet today</p>
                        <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">Click "Log Workout" to get started</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Workout Modal -->
    <div id="addWorkoutModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <span class="modal-close" onclick="closeAddWorkoutModal()">&times;</span>
            <h2>Log Workout</h2>
            <form id="addWorkoutForm">
                <div class="form-group">
                    <label for="workoutName">Workout Name *</label>
                    <input type="text" id="workoutName" placeholder="e.g., Morning Chest Day, Leg Session" required>
                </div>

                <div class="form-group">
                    <label for="workoutType">Workout Type *</label>
                    <select id="workoutType" required>
                        <option value="Strength">Strength Training</option>
                        <option value="Cardio">Cardio</option>
                        <option value="HIIT">HIIT</option>
                        <option value="Yoga">Yoga</option>
                        <option value="Sports">Sports</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="duration">Duration (minutes) *</label>
                    <input type="number" id="duration" placeholder="e.g., 45" required min="1">
                </div>

                <div class="form-group">
                    <label>Exercises</label>
                    <div id="exercisesList">
                        <!-- Exercises will be added here -->
                    </div>
                    <button type="button" onclick="addExerciseField()" class="btn btn-secondary btn-small">+ Add Exercise</button>
                </div>

                <div class="form-group">
                    <label for="workoutNotes">Notes (optional)</label>
                    <textarea id="workoutNotes" placeholder="How did the workout feel? Any PRs?" rows="3"></textarea>
                </div>

                <button type="submit" class="btn btn-large">Save Workout</button>
            </form>
        </div>
    </div>

    <script>
        const API_URL = 'https://bit-portfolio-1.onrender.com';
        
        // Check if user is logged in
        const token = localStorage.getItem('token');
        const user = JSON.parse(localStorage.getItem('user') || '{}');

        if (!token) {
            window.location.href = 'login.html';
        }

        function getUserPrefix() {
            return user.id ? user.id + '_' : '';
        }

        let exerciseCount = 0;

        // Load workouts on page load
        const today = getTodayDate();
        document.getElementById('selectedDate').value = today;
        loadWorkoutsForDate();

        function getTodayDate() {
            return new Date().toISOString().split('T')[0];
        }

        function loadWorkoutsForDate() {
            const selectedDate = document.getElementById('selectedDate').value;
            const workouts = JSON.parse(localStorage.getItem('workouts_' + getUserPrefix() + selectedDate) || '[]');
            
            displayWorkouts(workouts);
            updateWorkoutSummary(workouts);
        }

        function displayWorkouts(workouts) {
            const workoutsList = document.getElementById('workoutsList');
            const selectedDate = document.getElementById('selectedDate').value;
            const today = getTodayDate();
            const isToday = selectedDate === today;
            
            // Update header
            const dateObj = new Date(selectedDate + 'T00:00:00');
            const dateStr = isToday ? "Today's" : dateObj.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
            document.getElementById('workoutsHeader').textContent = `${dateStr} Workouts`;
            
            if (workouts.length === 0) {
                const message = isToday ? "No workouts logged yet today" : `No workouts logged for ${dateStr.toLowerCase()}`;
                workoutsList.innerHTML = `
                    <div class="empty-state">
                        <p>${message}</p>
                        <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">${isToday ? 'Click "Log Workout" to get started' : 'Select today to log workouts'}</p>
                    </div>
                `;
                return;
            }

            workoutsList.innerHTML = workouts.map((workout, index) => `
                <div class="workout-card">
                    <div class="workout-header">
                        <div>
                            <h3>${workout.name}</h3>
                            <span class="workout-type">${workout.type}</span>
                        </div>
                        <button onclick="deleteWorkout(${index})" class="delete-btn">üóëÔ∏è</button>
                    </div>
                    
                    <div class="workout-meta">
                        <span>‚è±Ô∏è ${workout.duration} min</span>
                        <span>üí™ ${workout.exercises.length} exercises</span>
                        ${workout.totalVolume ? `<span>üèãÔ∏è ${workout.totalVolume} lbs</span>` : ''}
                    </div>

                    <div class="exercises-list">
                        ${workout.exercises.map(ex => `
                            <div class="exercise-item">
                                <span class="exercise-name">${ex.name}</span>
                                <span class="exercise-details">
                                    ${ex.sets} sets √ó ${ex.reps} reps
                                    ${ex.weight ? ` @ ${ex.weight} lbs` : ''}
                                </span>
                            </div>
                        `).join('')}
                    </div>

                    ${workout.notes ? `<p class="workout-notes">${workout.notes}</p>` : ''}
                    <span class="workout-time">${formatTime(workout.timestamp)}</span>
                </div>
            `).join('');
        }

        function updateWorkoutSummary(workouts) {
            const selectedDate = document.getElementById('selectedDate').value;
            const today = getTodayDate();
            const isToday = selectedDate === today;
            
            const totalWorkouts = workouts.length;
            const totalExercises = workouts.reduce((sum, w) => sum + w.exercises.length, 0);
            const totalDuration = workouts.reduce((sum, w) => sum + parseInt(w.duration), 0);
            const totalVolume = workouts.reduce((sum, w) => sum + (w.totalVolume || 0), 0);

            document.getElementById('totalWorkouts').textContent = totalWorkouts;
            document.getElementById('totalExercises').textContent = totalExercises;
            document.getElementById('totalDuration').textContent = totalDuration;
            document.getElementById('totalVolume').textContent = totalVolume.toLocaleString();
            
            // Update labels
            document.querySelectorAll('.workout-stat-label')[0].textContent = isToday ? 'Workouts Today' : 'Workouts';
        }

        function openAddWorkoutModal() {
            document.getElementById('addWorkoutModal').style.display = 'flex';
            // Add initial exercise field
            if (exerciseCount === 0) {
                addExerciseField();
            }
        }

        function closeAddWorkoutModal() {
            document.getElementById('addWorkoutModal').style.display = 'none';
            document.getElementById('addWorkoutForm').reset();
            document.getElementById('exercisesList').innerHTML = '';
            exerciseCount = 0;
        }

        function addExerciseField() {
            const exercisesList = document.getElementById('exercisesList');
            const exerciseId = exerciseCount++;
            
            const exerciseDiv = document.createElement('div');
            exerciseDiv.className = 'exercise-field';
            exerciseDiv.id = `exercise-${exerciseId}`;
            exerciseDiv.innerHTML = `
                <div class="exercise-field-header">
                    <span>Exercise ${exerciseId + 1}</span>
                    <button type="button" onclick="removeExerciseField(${exerciseId})" class="remove-exercise-btn">√ó</button>
                </div>
                <div class="form-group">
                    <input type="text" class="exercise-name-input" placeholder="Exercise name (e.g., Bench Press)" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <input type="number" class="exercise-sets" placeholder="Sets" required min="1">
                    </div>
                    <div class="form-group">
                        <input type="number" class="exercise-reps" placeholder="Reps" required min="1">
                    </div>
                    <div class="form-group">
                        <input type="number" class="exercise-weight" placeholder="Weight (lbs)" min="0">
                    </div>
                </div>
            `;
            
            exercisesList.appendChild(exerciseDiv);
        }

        function removeExerciseField(id) {
            const field = document.getElementById(`exercise-${id}`);
            if (field) {
                field.remove();
            }
        }

        document.getElementById('addWorkoutForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Collect exercises
            const exercises = [];
            const exerciseFields = document.querySelectorAll('.exercise-field');
            let totalVolume = 0;
            
            exerciseFields.forEach(field => {
                const name = field.querySelector('.exercise-name-input').value;
                const sets = parseInt(field.querySelector('.exercise-sets').value);
                const reps = parseInt(field.querySelector('.exercise-reps').value);
                const weight = parseInt(field.querySelector('.exercise-weight').value) || 0;
                
                exercises.push({ name, sets, reps, weight });
                totalVolume += sets * reps * weight;
            });

            if (exercises.length === 0) {
                alert('Please add at least one exercise');
                return;
            }

            const workout = {
                name: document.getElementById('workoutName').value,
                type: document.getElementById('workoutType').value,
                duration: parseInt(document.getElementById('duration').value),
                exercises: exercises,
                totalVolume: totalVolume,
                notes: document.getElementById('workoutNotes').value,
                timestamp: new Date().toISOString()
            };

            const selectedDate = document.getElementById('selectedDate').value;
            const workouts = JSON.parse(localStorage.getItem('workouts_' + getUserPrefix() + selectedDate) || '[]');
            workouts.push(workout);
            localStorage.setItem('workouts_' + getUserPrefix() + selectedDate, JSON.stringify(workouts));

            loadWorkoutsForDate();
            closeAddWorkoutModal();
            showToast('Workout logged successfully!', 'success');
        });

        function deleteWorkout(index) {
            if (!confirm('Are you sure you want to delete this workout?')) return;
            
            const selectedDate = document.getElementById('selectedDate').value;
            const workouts = JSON.parse(localStorage.getItem('workouts_' + getUserPrefix() + selectedDate) || '[]');
            workouts.splice(index, 1);
            localStorage.setItem('workouts_' + getUserPrefix() + selectedDate, JSON.stringify(workouts));
            
            loadWorkoutsForDate();
            showToast('Workout deleted', 'success');
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('addWorkoutModal');
            if (event.target == modal) {
                closeAddWorkoutModal();
            }
        }
    </script>

    <style>
        .page-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 5px;
            color: #ffffff;
        }

        .page-subtitle {
            color: #999;
            font-size: 1rem;
        }

        .workout-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .workout-stat-card {
            background: linear-gradient(145deg, #1a1a1a, #0f0f0f);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .workout-stat-card:hover {
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .workout-icon {
            font-size: 2.5rem;
        }

        .workout-stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .workout-stat-label {
            color: #999;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .workouts-section h2 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #ffffff;
        }

        .workouts-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .workout-card {
            background: linear-gradient(145deg, #1a1a1a, #0f0f0f);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .workout-card:hover {
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .workout-header h3 {
            font-size: 1.3rem;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .workout-type {
            background: rgba(255, 255, 255, 0.1);
            color: #999;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .delete-btn {
            background: transparent;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.3s ease;
        }

        .delete-btn:hover {
            opacity: 1;
        }

        .workout-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            color: #999;
            font-size: 0.9rem;
        }

        .exercises-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .exercise-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .exercise-name {
            color: #ffffff;
            font-weight: 500;
        }

        .exercise-details {
            color: #999;
            font-size: 0.9rem;
        }

        .workout-notes {
            color: #999;
            font-size: 0.95rem;
            font-style: italic;
            margin: 15px 0 10px 0;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .workout-time {
            color: #666;
            font-size: 0.85rem;
        }

        /* Exercise Fields in Modal */
        .exercise-field {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .exercise-field-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: #999;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .remove-exercise-btn {
            background: rgba(255, 68, 68, 0.2);
            border: none;
            color: #ff4444;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            line-height: 1;
            transition: all 0.3s ease;
        }

        .remove-exercise-btn:hover {
            background: rgba(255, 68, 68, 0.3);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }

            .workout-summary {
                grid-template-columns: repeat(2, 1fr);
            }

            .workout-meta {
                flex-direction: column;
                gap: 8px;
            }

            .exercise-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .workout-summary {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>