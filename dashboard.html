<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Gainly</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h2>Gainly</h2>
            </div>
            <div class="nav-links">
                <a href="dashboard.html" class="nav-link active">Dashboard</a>
                <a href="calories.html" class="nav-link">Calories</a>
                <a href="workouts.html" class="nav-link">Workouts</a>
                <a href="recipes.html" class="nav-link">
                    Recipes
                    <span class="premium-badge">PRO</span>
                </a>
                <a href="progress.html" class="nav-link">
                    Progress
                    <span class="premium-badge">PRO</span>
                </a>
                <a href="profile.html" class="nav-link">Profile</a>
            </div>
            <button onclick="logout()" class="btn btn-small">Logout</button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div class="dashboard-container">
            <!-- Welcome Section -->
            <div class="dashboard-header">
                <h1>Welcome back, <span id="userName"></span>!</h1>
                <p class="date-display" id="currentDate"></p>
            </div>

            <!-- Premium Upsell Banner (show if not premium) -->
            <div class="premium-banner" id="premiumBanner">
                <div class="premium-banner-content">
                    <div>
                        <h3>üöÄ Upgrade to Gainly Premium</h3>
                        <p>Get access to recipes, meal planning, progress tracking, and more!</p>
                    </div>
                    <button onclick="showPremiumModal()" class="btn">Upgrade Now - $9.99/month</button>
                </div>
            </div>

            <!-- Quick Stats Grid -->
            <div class="stats-grid">
                <!-- Calories Card -->
                <div class="stat-card">
                    <div class="stat-header">
                        <h3>Today's Calories</h3>
                        <a href="calories.html" class="stat-link">View Details ‚Üí</a>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">
                            <span id="caloriesConsumed">0</span> / <span id="caloriesTarget">2000</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="caloriesProgress" style="width: 0%"></div>
                        </div>
                        <p class="stat-label"><span id="caloriesRemaining">2000</span> calories remaining</p>
                    </div>
                </div>

                <!-- Workouts Card -->
                <div class="stat-card">
                    <div class="stat-header">
                        <h3>Today's Workouts</h3>
                        <a href="workouts.html" class="stat-link">View Details ‚Üí</a>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="workoutsCount">0</div>
                        <p class="stat-label">workouts completed</p>
                        <button onclick="window.location.href='workouts.html'" class="btn btn-secondary btn-small">Log Workout</button>
                    </div>
                </div>

                <!-- Weight Card (Premium Feature Preview) -->
                <div class="stat-card premium-locked">
                    <div class="premium-overlay">
                        <span class="lock-icon">üîí</span>
                        <p>Premium Feature</p>
                    </div>
                    <div class="stat-header">
                        <h3>Weight Progress</h3>
                        <span class="premium-badge">PRO</span>
                    </div>
                    <div class="stat-content blurred">
                        <div class="stat-number">165 lbs</div>
                        <p class="stat-label">-5 lbs this month</p>
                    </div>
                </div>

                <!-- Streak Card (Premium Feature Preview) -->
                <div class="stat-card premium-locked">
                    <div class="premium-overlay">
                        <span class="lock-icon">üîí</span>
                        <p>Premium Feature</p>
                    </div>
                    <div class="stat-header">
                        <h3>Workout Streak</h3>
                        <span class="premium-badge">PRO</span>
                    </div>
                    <div class="stat-content blurred">
                        <div class="stat-number">üî• 12 days</div>
                        <p class="stat-label">Keep it up!</p>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="recent-activity">
                <h2>Recent Activity</h2>
                <div id="activityList" class="activity-list">
                    <p class="empty-state">No activity yet. Start tracking your calories or workouts!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Premium Modal -->
    <div id="premiumModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closePremiumModal()">&times;</span>
            <h2>Upgrade to Gainly Premium</h2>
            <div class="premium-features">
                <div class="feature-item">
                    <span class="feature-icon">üìö</span>
                    <div>
                        <h4>Recipe Library</h4>
                        <p>Access hundreds of healthy recipes with full nutritional information</p>
                    </div>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üìÖ</span>
                    <div>
                        <h4>Meal Planning</h4>
                        <p>Plan your meals for the week with smart shopping lists</p>
                    </div>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üìä</span>
                    <div>
                        <h4>Progress Tracking</h4>
                        <p>Visualize your weight, measurements, and strength gains over time</p>
                    </div>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üí™</span>
                    <div>
                        <h4>Workout Templates</h4>
                        <p>Pre-built workout routines for every fitness goal</p>
                    </div>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üì±</span>
                    <div>
                        <h4>Unlimited History</h4>
                        <p>Access all your past data, not just today's</p>
                    </div>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üìÑ</span>
                    <div>
                        <h4>Export to PDF</h4>
                        <p>Download your progress reports and meal plans</p>
                    </div>
                </div>
            </div>
            <div class="premium-pricing">
                <h3>$9.99/month</h3>
                <p>Cancel anytime. No commitments.</p>
                <button class="btn btn-large" onclick="upgradeToPremium()">Start Premium Trial</button>
                <p class="trial-note">7 days free, then $9.99/month</p>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://bit-portfolio-1.onrender.com';
        
        // Check if user is logged in
        const token = localStorage.getItem('token');
        const user = JSON.parse(localStorage.getItem('user') || '{}');

        if (!token) {
            window.location.href = 'login.html';
        } else {
            document.getElementById('userName').textContent = user.name || 'User';
        }

        // Display current date
        const today = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('currentDate').textContent = today.toLocaleDateString('en-US', options);

        // Check if user is premium (for now, everyone is free)
        const isPremium = localStorage.getItem('isPremium') === 'true';
        
        if (isPremium) {
            document.getElementById('premiumBanner').style.display = 'none';
            // Remove premium locks
            document.querySelectorAll('.premium-locked').forEach(card => {
                card.classList.remove('premium-locked');
                const overlay = card.querySelector('.premium-overlay');
                if (overlay) overlay.remove();
                const content = card.querySelector('.stat-content');
                if (content) content.classList.remove('blurred');
            });
        }

        // Load today's data
        loadTodayStats();

        async function loadTodayStats() {
            // Load calories
            const meals = JSON.parse(localStorage.getItem('meals_' + getTodayDate()) || '[]');
            const totalCalories = meals.reduce((sum, meal) => sum + meal.calories, 0);
            const target = 2000; // Default target
            
            document.getElementById('caloriesConsumed').textContent = totalCalories;
            document.getElementById('caloriesTarget').textContent = target;
            document.getElementById('caloriesRemaining').textContent = target - totalCalories;
            
            const percentage = Math.min((totalCalories / target) * 100, 100);
            document.getElementById('caloriesProgress').style.width = percentage + '%';

            // Load workouts
            const workouts = JSON.parse(localStorage.getItem('workouts_' + getTodayDate()) || '[]');
            document.getElementById('workoutsCount').textContent = workouts.length;

            // Load recent activity
            loadRecentActivity(meals, workouts);
        }

        function loadRecentActivity(meals, workouts) {
            const activityList = document.getElementById('activityList');
            const activities = [];

            meals.forEach(meal => {
    activities.push({
        type: 'meal',
        text: `Logged ${meal.name} - ${meal.calories} calories`,
        time: meal.timestamp
    });
});

workouts.forEach(workout => {
    activities.push({
        type: 'workout',
        text: `Completed ${workout.name}`,
        time: workout.timestamp
    });
});

            if (activities.length === 0) {
                activityList.innerHTML = '<p class="empty-state">No activity yet. Start tracking your calories or workouts!</p>';
                return;
            }

            // Sort by time (most recent first)
            activities.sort((a, b) => new Date(b.time) - new Date(a.time));

            activityList.innerHTML = activities.slice(0, 5).map(activity => `
                <div class="activity-item">
                    <span class="activity-icon">${activity.type === 'meal' ? 'üçΩÔ∏è' : 'üí™'}</span>
                    <div class="activity-text">
                        <p>${activity.text}</p>
                        <span class="activity-time">${formatTime(activity.time)}</span>
                    </div>
                </div>
            `).join('');
        }

        function getTodayDate() {
            return new Date().toISOString().split('T')[0];
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            const hours = Math.floor(diff / 3600000);
            const minutes = Math.floor(diff / 60000);
            
            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return date.toLocaleDateString();
        }

        function showPremiumModal() {
            document.getElementById('premiumModal').style.display = 'flex';
        }

        function closePremiumModal() {
            document.getElementById('premiumModal').style.display = 'none';
        }

        function upgradeToPremium() {
            // For demo purposes, just set premium to true
            localStorage.setItem('isPremium', 'true');
            alert('Welcome to Gainly Premium! üéâ\n\nYour premium features are now unlocked.');
            location.reload();
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('premiumModal');
            if (event.target == modal) {
                closePremiumModal();
            }
        }
    </script>
</body>
</html>